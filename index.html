<!DOCTYPE html>
<html>
<head>
	<title>Operator.js</title>
</head>
<body>
<script src='Operator.js'></script>
<script>

	var operator = new Operator(),
		appMessenger = operator.createMessenger('app'),
		messengerA = operator.createMessenger('A'),
		messengerB = operator.createMessenger('B'),
		messengerC = operator.createMessenger('C'),

		resizeConnection = {
			message: 'resize', 
			from: messengerA, 
			to: [messengerB, messengerC]
		},
		changeConnection = {
			message: 'change', 
			from: messengerC, 
			to: [messengerA]
		},
		disconnectChange = {
			message: 'change', 
			from: messengerC, 
			to: [messengerA]
		},
		disconnectConnection = {
			message: 'disconnect', 
			from: messengerA, 
			to: [appMessenger]
		};

	appMessenger.listen('disconnect', _disconnectChange);

	operator.connect(resizeConnection);
	operator.connect(disconnectConnection);
	operator.connect(changeConnection);

	function _disconnectChange(e) {
		console.log('appMessenger heard "disconnect":', e);
		operator.disconnect(disconnectChange);
	}

	var ModuleA = (function() {

		var events = null,
			box = null;

		function Module() {
			events.listen('change', _moduleChange);
			box = document.createElement('div');
			box.style.position = 'absolute';
			box.style.top = '40px';
			box.style.left = '10px';
			box.style.width = '200px';
			box.style.height = '200px';
			box.style.color = 'white';
			box.style.fontSize = '18px';
			box.style.textAlign = 'center';
			box.style.lineHeight = '200px';
			box.style.backgroundColor = 'red';
			var btn = document.createElement('button');
			btn.innerHTML = 'ModuleA resize';
			box.innerHTML = 'ModuleA';
			document.body.appendChild(btn);
			document.body.appendChild(box);

			btn.onclick = function() {
				console.log('button "ModuleA resize" clicked');
				events.report('resize', {data:'something about a resize...'});
			};
		}

		var counter = 0;

		function _moduleChange(e) {
			counter ++;
			box.innerHTML = 'ModuleA heard change ' + counter;
			console.log('module A heard message "change"', e);
			console.log('module A reported "disconnect"');
			events.report('disconnect', {data:'disconnect change connection please'});
		}

		return {
			init: function(eventObj) {
				events = eventObj;
				return new Module();
			}
		}

	})();

	var ModuleB = (function() {

		var events = null,
			box = null;

		function Module() {
			box = document.createElement('div');
			box.style.position = 'absolute';
			box.style.top = '40px';
			box.style.left = '220px';
			box.style.width = '200px';
			box.style.height = '200px';
			box.style.color = 'white';
			box.style.fontSize = '18px';
			box.style.textAlign = 'center';
			box.style.lineHeight = '200px';
			box.style.backgroundColor = 'green';
			box.innerHTML = 'ModuleB';
			events.listen('resize', _moduleResize);

			document.body.appendChild(box);
		}

		var counter = 0;

		function _moduleResize(e) {
			counter ++;
			box.innerHTML = 'ModuleB heard resize ' + counter;
			console.log('module B heard message "resize"', e);
		}

		return {
			init: function(eventObj) {
				events = eventObj;
				return new Module();
			}
		}

	})();

	var ModuleC = (function() {

		var events = null,
			box = null;

		function Module() {
			events.listen('resize', _moduleResize);
			box = document.createElement('div');
			box.style.position = 'absolute';
			box.style.top = '40px';
			box.style.left = '430px';
			box.style.width = '200px';
			box.style.height = '200px';
			box.style.color = 'white';
			box.style.fontSize = '18px';
			box.style.textAlign = 'center';
			box.style.lineHeight = '200px';
			box.style.backgroundColor = 'blue';
			box.innerHTML = 'ModuleC';
			var btn = document.createElement('button');
			btn.innerHTML = 'ModuleC change';
			document.body.appendChild(btn);
			document.body.appendChild(box);

			btn.onclick = function() {
				console.log('button "ModuleC change" clicked');
				events.report('change', {data:'something about a change...'});
			};
		}

		var counter = 0;

		function _moduleResize(e) {
			counter ++;
			box.innerHTML = 'ModuleC heard resize ' + counter;
			console.log('module C heard message "resize"', e);
		}

		return {
			init: function(eventObj) {
				events = eventObj;
				return new Module();
			}
		}

	})();

	var modA = ModuleA.init(messengerA),
		modB = ModuleB.init(messengerB),
		modC = ModuleC.init(messengerC);

</script>
</body>
</html>